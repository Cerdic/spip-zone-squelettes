[(#REM) 
	Affichage d'un document dans une carte geoportail (sous forme d'une image ou de sa vignette)
	
	Pour afficher le document xx :
	<imgxx|geoportail|id_geoportail=0|taille=20> 
	
	Parametres :
	- id_geoportail : id de la carte ou afficher l'image
	- titre	 : titre de la couche
	- taille : taille de l'image sur la carte
	- bord : taille du bord (en px)
	- couleur : couleur du bord
	- align : top, left, bottom, right ou combinaison : top-left...
]
<script type="text/javascript">

{	// Fonction surchargeant le popup pour afficher directement la photo
	var popup_fn = function(feature, pos, hover)
	{	// Afficher directement la photo lorsqu'on clique
        if (!hover)
        {   spipGeoportail.afficheImage(feature.attributes.url, feature.attributes.name + feature.attributes.description )
            spipGeoportail.unselectAll();
        }
        // Relancer la fonction standard de SPIP-Geoportail (sans mode hover)
        else
        {   var p = feature.attributes.popup;
            feature.attributes.popup = null;
            spipGeoportail.popupFeature(feature, pos, false);
			feature.attributes.popup = p;
        }
	}
<BOUCLE_doc(DOCUMENTS){geoposition}{id_article=#ID}>
    var att = { classe:'document', popup:popup_fn, 
			id_document:#ID_DOCUMENT, name:"[(#TITRE|attribut_html)]", extension:"#EXTENSION", 
			taille:"[(#TAILLE|taille_en_octets)]", width:"#LARGEUR", height:"#HAUTEUR", 
			img:"[(#LOGO_DOCUMENT|image_reduire{150}|||extraire_attribut{src})]", url:"#URL_DOCUMENT", 
			description:"([(#LON|geoportail_longitude{true}|addslashes)],[(#LAT|geoportail_latitude{true}|addslashes)])<br/>" 
				+"[(#DESCRIPTIF|addslashes|replace{\n,''}|replace{\r,''})]" };
	// Afficher
	[(#SET{largeur,[(#LOGO_DOCUMENT||image_reduire{40}|largeur|plus{[(#ENV{bord,4})]})]})]
	[(#SET{hauteur,[(#LOGO_DOCUMENT||image_reduire{40}|hauteur|plus{[(#ENV{bord,4})]})]})]
	[(#ENV{bord,4}|!={0}|?{
	$.geoportail.addImg ([(#ENV{id_geoportail,0})], #ID_DOCUMENT, "[(#ENV{titre}|sinon{[(#TITRE|attribut_html)]})]", #LON, #LAT, "[(#LOGO_DOCUMENT||image_reduire{40}|image_recadre{#GET{largeur},#GET{hauteur},center,#ENV{couleur,#FFFFFF}}|extraire_attribut{src})]", "[(#ENV{align})]", "[(#ENV{taille,20})]", att);
	,
	$.geoportail.addImg ([(#ENV{id_geoportail,0})], #ID_DOCUMENT, "[(#ENV{titre}|sinon{[(#TITRE|attribut_html)]})]", #LON, #LAT, "[(#LOGO_DOCUMENT||extraire_attribut{src})]", "[(#ENV{align})]", "[(#ENV{taille,20})]", att);
	})]

    if ("[(#ENV{align})]" == "center")
		$.geoportail.onLoad([(#ENV{id_geoportail,0})], function(map,id){ map.getMap().setCenterAtLonLat(#LON, #LAT, #ZOOM); } );
		
</BOUCLE_doc>
	// Recadrer sur l'extension
    [(#RECADRE|?{" "})
	$.geoportail.onLoad([(#ENV{id_geoportail,0})], function(map,id)
		{	map.getMap().zoomToExtent(map.spip_img.getDataExtent());
			if (map.getMap().getZoom() > 16) map.getMap().zoomTo(17);
		} );
    ]
}
</script>
