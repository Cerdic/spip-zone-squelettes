[(#REM)
	Liste des documents joints
]
<BOUCLE_si_telecharge(CONDITION){si #AUTORISER{mstelecharger,document,#ID_ARTICLE}|oui}>
[(#SET{docs_exclus,#ARRAY})]
[(#SET{documents_orig,#ARRAY})]
[(#SET{documents_copies,#ARRAY})]
[(#REM) 
	On exclus les documents que l'on ne veut pas voir apparaitre dans les documents téléchargeables
]
<BOUCLE_docs_exclus(DOCUMENTS){id_article}{mode IN document,image}{par num titre, date}>
	[(#SET{documents_orig,#GET{documents_orig}|push{#ID_DOCUMENT}})]
	<BOUCLE_conversions(DOCUMENTS){si #VAL{copies}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY}}|oui}{objet=document}{id_objet=#ID_DOCUMENT}{tout}>
		[(#SET{documents_copies,#GET{documents_copies}|push{#ID_DOCUMENT}})]
	</BOUCLE_conversions>
</BOUCLE_docs_exclus>
#SET{total,#GET{documents_copies}|count}
[(#VAL{original}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY}}|oui)
	#SET{total,#GET{total}|plus{#GET{documents_orig}|count}}
	#SET{id_document_par_defaut, #GET{documents_orig}|table_valeur{0}}
]
[(#VAL{original}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY}}|non)
	#SET{docs_exclus, #GET{documents_orig}}
	#SET{id_document_par_defaut, #GET{documents_copies}|table_valeur{0}}
]
#SET{id_document,#ENV{id_document,#GET{id_document_par_defaut,0}}}

[(#GET{total}|>{0}|oui)
<div class="info_media infos_documents" id="infos_documents">
	[<h3 class="h3">(#GET{total}|singulier_ou_pluriel{mediaspip_core:info_document,mediaspip_core:info_documents})</h3>]
	<div id="liste_docs_download">
		<ul class="liste-items">[(#SET{ferme_ul,oui})]
]

<BOUCLE_documents_joints_orig(DOCUMENTS){id_article}{mode !IN doc2img,conversion}{par num titre, date}>[(#GRAND_TOTAL|>{1}|oui)
			<li class="item info_media">
				<h4 class="#EDIT{titre}">[(#TITRE|sinon{[(#FICHIER|basename)]})]</h4>
			</li>][(#VAL{original}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY}}|oui)
			[(#INCLURE{fond=inclure/document-resume,id_document=#ID_DOCUMENT,expose=[(#ID_DOCUMENT|=={#GET{id_document}}|?{'on',''})]})]
			]
			<BOUCLE_documents_joints(DOCUMENTS){si #VAL{copies}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY{original,copies}}}|oui}{objet=document}{id_objet=#ID_DOCUMENT}{mode !IN doc2img}{id_document !IN #GET{docs_exclus}}{par num titre, date}{tout}>
			[(#INCLURE{fond=inclure/document-resume,id_document=#ID_DOCUMENT,expose=[(#ID_DOCUMENT|=={#GET{id_document}}|?{'on',''})]})]
			</BOUCLE_documents_joints>
		<B_documents_joints_doc2img>
		[(#GRAND_TOTAL|>{3}|oui)
		</ul>
		<ul class="liste-items">
			<li class="item">
				<h4 class="h4"><:mediaspip_core:info_documents_liens_directs_doc2img:></h3>
				#ANCRE_PAGINATION
				[<div class="pagination">(#PAGINATION{#ENV{type_pagination,page}})</div>]
			</li>]
			<BOUCLE_documents_joints_doc2img(DOCUMENTS){si #VAL{copies}|in_array{#CONFIG{mediaspip/squelettes/telecharger_types,#ARRAY}}|oui}{mode=doc2img}{objet=document}{id_objet=#ID_DOCUMENT}{par id_document}{pagination 5}{tout}>
			[(#INCLURE{fond=inclure/document-resume,id_document=#ID_DOCUMENT,expose=[(#ID_DOCUMENT|=={#GET{id_document}}|?{'on',''})]})]
			</BOUCLE_documents_joints_doc2img>[(#GRAND_TOTAL|>{5}|oui)
			<li class="item">
				[<div class="pagination">(#PAGINATION{#ENV{type_pagination,page}})</div>]
			</li>]
		</B_documents_joints_doc2img>
</BOUCLE_documents_joints_orig>

[(#GET{ferme_ul}|=={oui}|oui)
		</ul>
	</div>
</div>]

<B_doc>
<div class="info_media infos_techniques">
<BOUCLE_doc(DOCUMENTS){id_document=#GET{id_document}}{tout}>
	[(#MODE|in_array{#LISTE{conversion,doc2img}}|?{[(#MODE|=={doc2img}|?{<h4 class="h4"><:mediaspip_core:document_page{page=#PAGE}:></h4>,<h4 class="h4"><:mediaspip_core:document_version{version=#EXTENSION}:></h4>})],
	<h4 class="h4"><:mediaspip_core:document_version_originale:></h4>})]
	#INCLURE{fond=inclure/document-infos,id_document,ajax}
</BOUCLE_doc>
</div>
</B_doc>
[<div class="info_media infos_documents" id="liens_documents">(#INCLURE{fond=inclure/documents-medias_links,id_article,env,ajax}|trim)</div>]
</BOUCLE_si_telecharge>
#FILTRE{trim}
