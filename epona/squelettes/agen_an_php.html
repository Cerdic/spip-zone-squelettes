<?php

$months = array('', '<:nom_mois_1:>', '<:nom_mois_2:>', '<:nom_mois_3:>', '<:nom_mois_4:>', '<:nom_mois_5:>', '<:nom_mois_6:>', '<:nom_mois_7:>', '<:nom_mois_8:>', '<:nom_mois_9:>', '<:nom_mois_10:>', '<:nom_mois_11:>', '<:nom_mois_12:>');
$days = array('<:date_jour_1:>', '<:date_jour_2:>', '<:date_jour_3:>', '<:date_jour_4:>', '<:date_jour_5:>', '<:date_jour_6:>', '<:date_jour_7:>');

if (!isset($date)) $date = date('Y');
if (!isset($genre)) $genre = "<:tout:>";

// Liste des evenements agenda
$events = array();
$mois='' ;

function ajoute_evt ($date_redac, $soustitre, $titre, $url_article) {
  global $mois, $events, $date, $months, $days;
  if ($date_redac == '') return;
  ereg("^([0-9]{4})-([0-9]+)-([0-9]+).*$", $date_redac, $regs);
  if ($regs[1] != $date) return;
  ereg("([0-9]+) +jour", $soustitre, $nb_jour);
  if ($nb_jour[1]!="")  {$duree=' ('.$nb_jour[1].' jours)';} else $duree="" ;
  if ($months[intval($regs[2])] != $mois ) {
     if ($mois=='') { $events[]= '<br><h2>'.$months[intval($regs[2])].' '.$date.'</h2><ul>';
     } else { $events[]= '</ul><h2>'.$months[intval($regs[2])].' '.$date.'</h2><ul>'; }
     $mois = $months[intval($regs[2])];
  }
  $events[]= '<li><b> '.$days[date("w", mktime(0,0,0,intval($regs[2]),$regs[3],$regs[1]))].' '.$regs[3].'</b> : <a href="'.$url_article.'">'.$titre.'</a>'.$duree.'</li>';
}

function ajoute_evt_mot ($date_redac, $soustitre, $titre, $mot, $url_article) {
  global $mois, $events, $genre, $date, $months, $days;
  if ($date_redac == '') return;
  ereg("^([0-9]{4})-([0-9]+)-([0-9]+).*$", $date_redac, $regs);
  if ($regs[1] != $date) return;
  ereg("($genre)", $mot, $res);
  if (($genre!='<:tout:>') && ($genre!=$res[1]) ) return;
  ereg("([0-9]+) +jour", $soustitre, $nb_jour);
  if ($nb_jour[1]!="")  {$duree=' ('.$nb_jour[1].' jours)';} else $duree="" ;
  if ($months[intval($regs[2])] != $mois ) {
     if ($mois=='') { $events[]= '<br><h2>'.$months[intval($regs[2])].' '.$date.'</h2><ul>';
     } else { $events[]= '</ul><h2>'.$months[intval($regs[2])].' '.$date.'</h2><ul>'; }
     $mois = $months[intval($regs[2])];
  }
  $events[]= '<li><b> '.$days[date("w", mktime(0,0,0,intval($regs[2]),$regs[3],$regs[1]))].' '.$regs[3].'</b> : <a href="'.$url_article.'">'.$titre.'</a>'.$duree.'</li>';
}

function boutons_an_voisin ($pagean,$date) {
   $url = $pagean.'&amp;date='.($date -1);
   echo '<a href="'.$url.'"><img src="#DOSSIER_SQUELETTE/prev.gif" title="<:precedent:>" alt="" border=0 /></a>';
   $url = $pagean.'&amp;date='.date('Y');
   echo '<input type="button" value="<:aujourdhui:>" onClick="document.location.href=\''.$url.'\'; return false;" />';
   $url = $pagean.'&amp;date='.($date+1);
   echo '<a href="'.$url.'"><img src="#DOSSIER_SQUELETTE/next.gif" title="<:suivant:>" alt="" border=0 /></a>';
}

function affiche_an ($pagean) {
  global $events, $date;
   echo '<table cellpadding="5" border="1" class="agenda"> <tr> <th colspan="7" class="agendaNav">';
   boutons_an_voisin ($pagean, $date);
   echo '<br> <form name="navigation" method="get" action="">';
   echo '<select name="var_nav_year">';
   for($i = 2000; $i < 2011; $i++)
     echo '<option value="'.$i.'"'.($i == $date ? ' selected="selected" ' : '').'>'.$i.'</option>';
   echo '</select>';
   echo '<input type="button" value="Ok" onClick="document.location.href=\''.$pagean.'&amp;date=\' + window.document.navigation.var_nav_year.value ; return false;" />';
   echo '</form> </th> </tr> </table>';
  // On affiche la liste des evenements
  foreach ($events as $elem) echo $elem;
  if (count($events)>0) { echo '</ul>'; }
}

function affiche_an_mot ($pagean) {
  global $events, $genre, $date;
  $mot_cle = array('<:tout:>', '<BOUCLE_LstMotsClefs(MOTS){type=_Agenda}{par titre}{"', '"}>[(#TITRE|texte_script)]</BOUCLE_LstMotsClefs>');
   echo '<table cellpadding="5" border="1" class="agenda"> <tr> <th colspan="7" class="agendaNav">';
   boutons_an_voisin ($pagean.'&amp;genre='.$genre, $date);
   echo '<br> <form name="navigation" method="get" action="">';
   echo '<select name="var_nav_year">';
   for($i = 2000; $i < 2011; $i++)
     echo '<option value="'.$i.'"'.($i == $date ? ' selected="selected" ' : '').'>'.$i.'</option>';
   echo '</select>';
   echo '<select name="var_nav_cle">';
   for($i = 0; $i < count($mot_cle); $i++) {
      $t = strcmp($mot_cle[$i], $genre);
      echo '<option value="'.$mot_cle[$i].'"'.($t == 0 ? ' selected="selected"' : '').'>'.$mot_cle[$i].'</option>';
   }
   echo '</select>';
   echo '<input type="button" value="Ok" onClick="document.location.href=\''.$pagean.'&amp;date=\' + window.document.navigation.var_nav_year.value + \'&amp;genre=\' + window.document.navigation.var_nav_cle.value ; return false;" />';
   echo '</form> </th> </tr> </table>';
  // On affiche la liste des evenements
  foreach ($events as $elem) echo $elem;
  if (count($events)>0) { echo '</ul>'; }
}

?>
