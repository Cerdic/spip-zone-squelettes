<?php
	// Si on clique sur 'vu' poser un cookie
	if ($vu) {
		spip_setcookie('sedna_vu[(#ENV{site_lu})]', $vu, time()+365*24*3600);
		$_COOKIE['sedna_vu[(#ENV{site_lu})]'] = $vu;
	}
	// Si on clique sur 'afficher/masquer' poser un cookie	
	if ($des) {
		setcookie("sedna_des", $des, time()+365*24*3600);
		$_COOKIE["sedna_des"] = $des;	    
	}
?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="#LANG" xml:lang="#LANG" dir="#LANG_DIR">
<head>
<title>[Sedna RSS] [(#NOM_SITE_SPIP|supprimer_tags)]</title>
<meta http-equiv="Content-Type" content="text/html; charset=#CHARSET" />


<!-- Lien vers le backend -->
<BOUCLE_url_backend_ori(SITES){id_syndic}>
	<link rel="alternate" type="application/rss+xml" title="RSS [(#NOM_SITE|attribut_html)], via [(#NOM_SITE_SPIP|attribut_html)]" href="#URL_SITE_SPIP/sedna.php?rss=1&amp;id_syndic=#ID_SYNDIC[&amp;recherche=(#ENV{recherche})]" />
	<link rel="alternate" type="application/rss+xml" title="RSS original" href="#URL_SYNDIC" />
</BOUCLE_url_backend_ori>
	<link rel="alternate" type="application/rss+xml" title="RSS [(#NOM_SITE_SPIP|attribut_html)]" href="#URL_SITE_SPIP/sedna.php?rss=1[&amp;recherche=(#ENV{recherche})]" />
<//B_url_backend_ori>

<link href="sedna.css" rel="stylesheet" type="text/css" />
</head>

<body>

<div class="top">
<a href="sedna.php">[Sedna RSS]</a>
	&nbsp;
<BOUCLE_titre(SITES){id_syndic}>#NOM_SITE
	&nbsp;
	<small><a href="#URL_SITE">#URL_SITE</a></small>
</BOUCLE_titre>
	#NOM_SITE_SPIP
	&nbsp;
	<small><a href="#URL_SITE_SPIP/">#URL_SITE_SPIP/</a></small>
<//B_titre>
[
&nbsp; <b>Recherche : &laquo; (#ENV{recherche}) &raquo;</b>]
</div>

<div class="marge">

[<form action="#SELF" method="POST">
<input type="hidden" name="refresh" value="(#ENV{id_syndic})" />
<input type="submit" name="ok" value="Rafra&icirc;chir" style="font-size:9px;" />
</form>]

<h1>Articles r&eacute;cents</h1>
<ul>
	<li><a href="?[&amp;id_syndic=(#ENV{id_syndic})][&amp;recherche=(#ENV{recherche})]"
	class="[(#ENV{age}|=={''}|?{'selected',''})]">Aujourd'hui</a></li>
	<li><a href="?age=2[id_syndic=(#ENV{id_syndic})][&amp;recherche=(#ENV{recherche})]"
	class="[(#ENV{age}|=={2}|?{'selected',''})]">Deux jours</a></li>
	<li><a href="?age=7[&amp;id_syndic=(#ENV{id_syndic})][&amp;recherche=(#ENV{recherche})]"
	class="[(#ENV{age}|=={7}|?{'selected',''})]">Semaine</a></li>
	<li><a href="?age=31[&amp;id_syndic=(#ENV{id_syndic})][&amp;recherche=(#ENV{recherche})]"
	class="[(#ENV{age}|=={31}|?{'selected',''})]">Mois</a></li>
	<li><a href="?age=365[&amp;id_syndic=(#ENV{id_syndic})][&amp;recherche=(#ENV{recherche})]"
	class="[(#ENV{age}|=={365}|?{'selected',''})]">Ann&eacute;e</a></li>
</ul>
<h1>Recherche</h1>
<form action="#SELF" method="get">
<div>
	<input type="text" name="recherche" value="[(#ENV{recherche})]" size="10" />
	[<input type="hidden" name="age" value="(#ENV{age})" />]
	[<input type="hidden" name="id_syndic" value="(#ENV{id_syndic})" />]
	<input type="submit" name="ok" value="ok" style="font-size:9px;" />
</div>
</form>

<h1>Description</h1>
<?php
if ($_COOKIE['sedna_des'] == "oui") {
	echo'<form action="#SELF" method="post"><div>';
	echo'<input type="hidden" name="des" value="non" />';
	echo'<input type="submit" name="ok" value="Masquer" style="font-size:9px;" />';
	echo'</div></form>';
	}else {
	echo'<form action="#SELF" method="post"><div>';
	echo'<input type="hidden" name="des" value="oui" />';
	echo'<input type="submit" name="ok" value="Afficher" style="font-size:9px;" />';
	echo'</div></form>';
}?>
<h1>Sources</h1>
<ul>
	<li><a href="?" class="[(#ENV{id_syndic}|=={''}|?{'selected',''})]"><b>Toutes</b></a></li>
	<li><a></a></li>
<BOUCLE_sites(SITES){par nom_site}{syndication=oui}>
	<li><a href="?[age=(#ENV{age})&amp;]id_syndic=#ID_SYNDIC"
	class="[(#ENV{id_syndic}|=={#ID_SYNDIC}|?{'selected',''})]">#NOM_SITE</a></li>

<?php
	$memo_#ID_SYNDIC =
		'<a href="?[age=(#ENV{age})&amp;]id_syndic=#ID_SYNDIC">[(#NOM_SITE|texte_script)]</a>';
?>
</BOUCLE_sites>
</ul>

</div>

<div class="milieu">
<B_syndic><div id="total_articles">#TOTAL_BOUCLE articles</div>
<BOUCLE_syndic(SYNDIC_ARTICLES){contenu}{id_syndic?}{par date}{inverse}{age<#ENV{age,1}}{0,500}>

<?php
	$jailu = '[<div style="float: right;">
	<!-- Bouton "Tout marquer comme vu" si ID_SYNDIC, et hors mode recherche -->
	(#ENV{recherche}|=={''}|?{' ',''})
	[<form action="#SELF" method="post"><div>
	<input type="hidden" name="site_lu" value="(#ID_SYNDIC|unique)" />
	<input type="hidden" name="vu" value="[(#DATE|affdate{'U'})]" />
	<input type="submit" name="ok" value="lu" style="font-size:9px;" />
	</div></form>]
	</div>]';
?>

	[
		[(#COMPTEUR_BOUCLE|>{1}|?{'</ul>',''})]
		<h1 class="date">(#DATE|affdate_court|unique)</h1>
		<?php echo $jailu; ?>
		<h2 class="site"><?php
			echo $memo_#ID_SYNDIC;
			$ex_syndic=#ID_SYNDIC;
		?></h2>
		<ul>
	]

<?php
	// indiquer un intertitre si on change de source ou de date
	if (#ID_SYNDIC <> $ex_syndic) {
		echo "</ul>\n";
		echo $jailu;
		echo '<h2 class="site">';
		echo $memo_#ID_SYNDIC;
		echo "</h2>\n";
		echo "<ul>\n";
	}
	$ex_syndic = #ID_SYNDIC;

	// regler la classe des liens, en fonction de la date p/r date du cookie 'vu'
	$class_link = (
		[(#DATE|affdate{'U'})]<=$_COOKIE['sedna_vu#ID_SYNDIC']
		) ? 'vu' : '';
?>

	<li class='item'>

	[<small>(#DATE|affdate{'H:i'})</small>] &nbsp;
	<a href="#URL_ARTICLE"
	title="[(#URL_ARTICLE|attribut_html)]"
	class="link<?php echo $class_link; ?>"
	>[(#TITRE|supprimer_numero|antispam2)]</a>
	[ - (#LESAUTEURS|antispam2)]
	<?php

	if ($_COOKIE['sedna_des'] == "oui") {?>
		[<a class="desc" href="#URL_ARTICLE">(#DESCRIPTIF|antispam2|textebrut)</a>]   
	<?}
	?>

	</li>

</BOUCLE_syndic>
</ul>
</B_syndic>

	<h1 class="date">Pas d'article dans cette p&eacute;riode&nbsp;!</h1>
<//B_syndic>
</div>

#SPIP_CRON
</body>
</html>
