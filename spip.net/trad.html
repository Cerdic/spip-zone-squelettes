#CACHE{7200}
<BOUCLE_principale(RUBRIQUES) {id_rubrique=4}>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="#LANG_DIR" lang="#LANG">
<head>
<title><:trad_bilan:> - [(#NOM_SITE_SPIP|textebrut)]</title>
[<meta name="description" content="(#INTRODUCTION|couper{150}|attribut_html)" />]
<INCLURE{fond=inc-head}>
<style>
table { width: 100%; 
font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 10px; }
th { background: #CC9; /*empty-cells: hide;*/ border-left: 1px solid #fff; font-weight: normal; padding: 2px 1px; }
td { border: 1px solid #eee; border-right: none; border-left: none; }
td.colun, td.colun * { color: #333; }
td.coldeux, td.colplus { text-align: center; min-width: 2%; border-left: 1px solid #fff; }
td.coldeux, td.coldeux * { color: #fff; }
td.colplus, td.colplus * { color: #333; }
</style>
</head>

<body class="page_rubrique">
<div id="page">
<INCLURE{fond=inc-entete}>

	[(#REM) Fil d'Ariane ]
	<div id="hierarchie"><a href="#URL_SITE_SPIP/#LANG"><:accueil_site:></a>[ &gt; <a href="(#URL_RUBRIQUE)"><:trad_espace:></a>] &gt; <:trad_bilan:></div>

	<div id="conteneur">

		[(#REM) Contenu principal : contenu de la rubrique ]

		<div id="contenu">
			<div class="cartouche">
				[(#LOGO_RUBRIQUE||image_reduire{100})]
				<h1><:trad_bilan:></h1>
			</div>
			
			<p class="chapo">Cette page pr&eacute;sente le <:trad_bilan:> de ce site. Les articles de r&eacute;f&eacute;rence sont affich&eacute;s en gras. La couleur de l'article correspond &agrave; son statut. La couleur <span style="background-color: purple; color: #fff; padding: 0 1px;">violette</span> signale les articles publi&eacute;s qui sont &agrave; v&eacute;rifier, l'original ayant une date de modification plus r&eacute;cente qu'eux.</p>
			<br class="nettoyeur" />

<?php

include ("ecrire/inc_version.php");
include_ecrire("inc_presentation");
include_ecrire("inc_minipres");
include_ecrire("inc_filtres");
include_ecrire("inc_layer");
include_ecrire("inc_texte");
include_ecrire("inc_connect");

install_debut_html("Suivi des traductions", "documents", "articles");

function icone_statut($statut_article, $source='puces') {
	static $couleurs = array(
		'publie'=>'green',
		'prepa'=>'grey',
		'prop'=>'orange',
		'refuse'=>'red',
		'poubelle'=>'black');
	static $puces = array(
		'publie'=>'verte',
		'prepa'=>'blanche',
		'prop'=>'orange',
		'refuse'=>'rouge',
		'poubelle'=>'poubelle');

	return ${$source}[$statut_article];
}

function rub($lang) {
	if ($lang == 'fr')
		return 91;  // cas particulier du francaoui qui

	$s = spip_query("SELECT id_secteur
		FROM spip_rubriques WHERE id_parent=0 AND
		lang = '$lang' AND id_secteur<>4");

	$t = spip_fetch_array($s);

	return $t['id_secteur'];		
}

echo "<table><thead><th></th>\n";

$langues = explode(',', lire_meta('langues_utilisees'));

foreach ($langues as $langue) {
	$rub[$langue] = rub($langue);
	echo "<th>". substr($langue." * ",0,3) ."</th>";
}

$limito = ($afficher_non_traduits == 'oui') ? "WHERE id_trad = 0" : "WHERE id_trad > 0";

$s = spip_query("SELECT * FROM spip_articles $limito AND statut<>'poubelle' ORDER BY id_trad DESC,id_article<>id_trad,lang");

while ($a = spip_fetch_array($s)) {

	if (($a['id_trad'] <> $id_trad) OR ($a['id_trad']==0)) {
		if ($visible) $affiche[$num][] = $tt.@join('', $tdd);

		$num=0;
		$tt = "</thead>\n<tr><td class='colun'>\n";
		if ($no_url)
			$tt .= substr(supprimer_numero($a['titre']),0,14);
		else
			$tt .= substr(supprimer_numero($a['titre']),0,25);
		$id_trad = $a['id_trad'];

		$date_modif = $a['date_modif'];

		if (!$id = $id_trad) $id=$a['id_article'];

		foreach ($langues as $langue) {
			$url_creer = "ecrire/?exec=articles_edit&new=oui&lier_trad=$id&id_rubrique=".$rub[$langue];
			$tdd[$langue] = "<td class='colplus'><a href='$url_creer' title='$langue'>+</a></td>";
			if ($no_url) $tdd[$langue] = "<td class='colplus'>+</td>";
		}
		$tdd[''] = "<td></td>\n";

		$visible = false;
	}

	if ($a['statut'] == 'publie') $visible = true;

	$titre = entites_html(supprimer_numero($a['titre']));
	$couleur = icone_statut($a['statut'],'couleurs');
	$num ++;

	if (($a['date_modif'] < $date_modif) AND ($a['statut']='publie')) $couleur = 'purple';

	$url = 'ecrire/?exec=articles&id_article='.$a['id_article'];
	$td = "<td class='coldeux' bgcolor='$couleur'>";
	$td .= "<a href='$url' title=\"$titre\">";

	$la_langue = substr($a['lang']." * ",0,3);
	if ($a['id_trad'] == $a['id_article']) $la_langue = "<b>$la_langue</b>";
	$td .= $la_langue;

	$td .= "</a></td>\n";

	if ($no_url) $td="<td>$la_langue</td>";

	$tdd[$a['lang']] = $td;
}

if ($visible) $affiche[$num][] = $tt.@join('', $tdd);

$keys = array_keys($affiche);
rsort($keys);
foreach ($keys as $nombre) {
	echo join ('', $affiche[$nombre]);
}

echo "</tr></table>";

if ($afficher_non_traduits == 'oui')
	echo "<br /><a href='#URL_PAGE{trad}'>Afficher les articles traduits</a>\n";
else
	echo "<br /><a href='[(#URL_PAGE{trad}|parametre_url{afficher_non_traduits,oui})]'>Afficher les articles non traduits</a>\n";

install_fin_html();

?>

		</div><!-- fin contenu -->

		[(#REM) Menu de navigation laterale ]
		<div id="navigation">

			<INCLURE{fond=inc-download}>
			
			<div class="rubriques">
				<BOUCLE_rubriques_trad(RUBRIQUES){id_rubrique=4}>
				<h2 class="menu-titre"><:navigation:></h2>
				<B_sousrub_trad><ul>
				<BOUCLE_sousrub_trad(RUBRIQUES){id_parent}{par lang}>
				<li><a href="#URL_RUBRIQUE"[ class="(#EXPOSE)"]><em>&#91;#LANG&#93;</em> [(#TITRE|couper{80})]</a></li>
				</BOUCLE_sousrub_trad>
				</ul></B_sousrub_trad>
				</BOUCLE_rubriques_trad>
			</div>

		</div><!-- fin navigation -->
	
	<br class="nettoyeur" />
	</div><!-- fin conteneur -->

<INCLURE{fond=inc-pied}{skel=#SQUELETTE}>

</div><!-- fin page -->
</body>
</html>
</BOUCLE_principale>