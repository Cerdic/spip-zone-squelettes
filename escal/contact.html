#CACHE{24*3600}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="#LANG">
  <head>
    <title><:escal:contact:> - [[(#NOM_SITE_SPIP|textebrut)]]
    </title>
    [<meta name="description" content="(#INTRODUCTION|couper{150}|textebrut)" />]
    <INCLURE {fond=inclusions/inc-head}>
  </head>

  <body onload="setHover('menu')">
    <div id="ombre-gauche">
      <div id="ombre-droite">
        <div id="conteneur">

          <div id="entete">
            <INCLURE {fond=inclusions/inc-titre_page}{lang}>
            <INCLURE {fond=inclusions/inc-bandeau}>
            <INCLURE {fond=inclusions/inc-menu}{id_rubrique}{lang}>
          </div>

          <div id="espace">
          </div>

          <div id="page">
            <div id="contenu">
              <div id="cadre-rubrique">
                <div id="titre-rubrique">Page contact
                </div>
              </div>
              <div id="formulaire-contact">
                <div id="descriptif-article">
                  <:escal:contact_bienvenue:>
                </div>
<?php
//
// Merci &agrave; Alain Sichel pour cette page contact
//
// on construit le formulaire
//
function formulaire($Nom="",$Prenom="",$Email="",$Sujet="",$Message="") {
                ?>
                <form action="<?php echo $PHP_SELF ?>" method="post">
                  <ul id="item">  <li>
                    <div class="liste"><:escal:contact_nom:></div>
                    <input type="text" name="Nom" size="30" value="<?php echo trim(htmlentities($_POST['Nom'])) ?>" /></li>  <li>
                    <div class="liste"><:escal:contact_prenom:></div>
                    <input type="text" name="Prenom" value="<?php echo trim(htmlentities($_POST['Prenom'])) ?>" size="30" /></li>  <li>
                    <div class="liste"><:escal:contact_mail:></div>
                    <input type="text" name="Email" value="<?php echo trim(htmlentities($_POST['Email'])) ?>" size="30" /></li>  <li>
                    <:escal:contact_motif:> 
                    <ul>      <li>
                      <input type="radio" name="Sujet" value="Renseignement"  size="30" <?php if ($_POST['Sujet']=='Renseignement') { echo 'checked="checked"'; } ?> /><:escal:contact_motif1:></li>      <li>
                      <input type="radio" name="Sujet" value="Inscription"  size="30" <?php if ($_POST['Sujet']=='Inscription') { echo 'checked="checked"';  } ?> /><:escal:contact_motif2:></li>      <li>
                      <input type="radio" name="Sujet" value="Probleme Technique"  size="30" <?php if ($_POST['Sujet']=='Probleme_Technique') { echo 'checked="checked"';  } ?> /><:escal:contact_motif3:></li>      <li>
                      <input type="radio" name="Sujet" value="Avis sur le site"  size="30" <?php if ($_POST['Sujet']=='Avis sur le site') { echo 'checked="checked"';  } ?> /><:escal:contact_motif4:></li>      <li>
                      <input type="radio" name="Sujet" value="Autre sujet"  size="30" <?php if ($_POST['Sujet']=='Autre sujet') { echo 'checked="checked"';  } ?> /><:escal:contact_motif5:></li>
                    </ul>  </li>   <li>
                    <:escal:contact_checkbox:><br /><br /> 
                      <input type="checkbox" name="Niveau[]" value="Bon"  size="30" <?php if ($_POST['Niveau']=='Bon') { echo 'checked="checked"'; } ?> /><:escal:contact_checkbox1:>
                      <input type="checkbox" name="Niveau[]" value="Correct"  size="30" <?php if ($_POST['Niveau']=='Correct') { echo 'checked="checked"';  } ?> /><:escal:contact_checkbox2:>
                      <input type="checkbox" name="Niveau[]" value="Moyen"  size="30" <?php if ($_POST['Niveau']=='Moyen') { echo 'checked="checked"';  } ?> /><:escal:contact_checkbox3:>
                      <input type="checkbox" name="Niveau[]" value="Passable"  size="30" <?php if ($_POST['Niveau']=='Passable') { echo 'checked="checked"';  } ?> /><:escal:contact_checkbox4:>
                      <input type="checkbox" name="Niveau[]" value="Mauvais"  size="30" <?php if ($_POST['Niveau']=='Mauvais') { echo 'checked="checked"';  } ?> /><:escal:contact_checkbox5:>
                    </li>   
                  <br /><li><:escal:contact_message:></li> <br />
                  <li>
                    <textarea name="Message" rows="10" cols="35" style="background-color:#ffffff"><?php if (ereg("[]%~#`$&|}{^[><]",$Message)) { echo "Certains caract&egrave;res utilis&eacute;s sont interdits";
                    $erreur=1; }
                    else {echo trim($_POST['Message']); } ?></textarea>  </li>  <li>
                    <input id="envoi" type="submit" name="Submit" value="<:escal:contact_envoyer:>" alt="Envoi"  title="Envoi de votre message" />  </li>
                  </ul>
<?php
//
// on recupere les donnees 
// on verifie si tout est bien rempli, sinon on envoie un message d'alerte
// si oui on prepare le contenu du mail
//
}
  include_spip('inc/filtres');

	$nom_site = entites_html($GLOBALS['meta']["nom_site"]);
	$email_webmaster = entites_html($GLOBALS['meta']["email_webmaster"]);
if(!isset($_POST["Nom"])) {
	formulaire();
}
else {
	$vNom=trim(htmlentities($_POST["Nom"]));
	$vPrenom=trim(htmlentities($_POST["Prenom"]));
	$vMessage=trim(utf8_decode($_POST["Message"]));
	$vEmail=trim(htmlentities($_POST["Email"]));
	$vSujet=trim(htmlentities($_POST["Sujet"]));
	$destinataire=$email_webmaster;
	$titre="Page contact de $nom_site";
	$message="Provenance : " . $_SERVER['HTTP_REFERER'] . "\n";
	$message.="Adresse IP : " . $_SERVER['REMOTE_ADDR'] . "\n";
	$message.="Navigateur : " . $_SERVER['HTTP_USER_AGENT'] . "\n\n";
	$message.="Nom : $vNom\n";
	if (empty($vNom)) {
		echo "<p class='alerte'><:escal:contact_alerte_nom:></p>";
		$erreur=1;
	}	
	$message.="Prenom : $vPrenom\n\n";
	if (empty($vPrenom)) {
		echo "<p class='alerte'><:escal:contact_alerte_prenom:></p>";
		$erreur=1;
	}	
	$message.="E-mail : $vEmail\n\n";
	if (empty($vEmail)) {
		echo "<p class='alerte'><:escal:contact_alerte_mail1:></p>";
		$erreur=1;
	}
	if (!eregi("^[0-9a-z]([-_.]?[0-9a-z])*@[0-9a-z]([-_.]?[0-9a-z])*\\.[a-z]{2,4}$",$vEmail) && ($erreur<>1)){
		echo "<p class='alerte'><:escal:contact_alerte_mail2:></p>";
		$erreur=1;
	}	
	$message.="Motif : $vSujet\n\n";
	if (empty($vSujet)) {
		echo "<p class='alerte'><:escal:contact_alerte_motif:></p>";
		$erreur=1;
	}
  if (empty($niveau)) {
    echo "<p class='alerte'><:escal:contact_alerte_checkbox:></p>";
    $erreur=1;
  }
  else {
    $message.= "Niveau : ";
    foreach ($_POST['Niveau'] as $niveau) {
        $message.= " - ".$niveau; 
    }
  }
  $message.=" \n\n Message : \n $vMessage\n";
  if (empty($vMessage)) {
		echo "<p class='alerte'><:escal:contact_alerte_message:></p>";
		$erreur=1;
	}

	if ($erreur==1) {
		formulaire($Nom,$Prenom,$Email,$Sujet,$Message);
	}
	else {
//
// on prepare les headers et on envoie le mail
//
	       $headers ='From: <'.$vEmail.'>'."\n";
         $headers .='Content-Type: text/plain; charset="iso-8859-1"'."\n";
         $headers .='Content-Transfer-Encoding: 8bit';
   mail($destinataire,$titre,$message,$headers) ;
//
// on renvoie un message de confirmation
//
		echo '<p class="texte-retour1">
		<:escal:contact_retour_bonjour:> <span class="valeur1">  '. $vPrenom.' '. $vNom.'</span>.<br />
		<:escal:contact_retour_commentaire:>
		<span class="valeur1"> '. $vEmail.'</span>
		 </p>';
		echo '<p class="texte-retour2"><:escal:contact_motif:></p>';
		echo '<p class="valeur2">'. $vSujet.'</p>';
		echo '<p class="texte-retour2"><:escal:contact_retour_checkbox:></p>';
		for ($i=0; $i<count($_POST["Niveau"]); $i++)
		echo '<p class="valeur2">'. $_POST["Niveau"][$i].'</p>';
		echo '<p class="texte-retour2"><:escal:contact_message:></p>';

		echo '<p class="valeur3">'. $vMessage=utf8_encode(nl2br($vMessage)) .'</p>';
	}
}
                  ?>
                </form>
              </div><!-- fin formulaire-contact -->
            </div><!-- fin contenu -->
          </div><!-- fin page -->

          <div id="navigation">
            <div class="cadre-bleu">
              <INCLURE {fond=inclusions/inc-acces_direct}{lang}>
            </div>
          </div>

          <div id="pied">
            <INCLURE {fond=inclusions/inc-pied}{skel=#SQUELETTE}{lang}>
          </div>

        </div><!-- fin conteneur -->
      </div>
    </div>
  </body>
</html>