<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="#LANG">
  <head>
    <title><:escal:contact:> - [[(#NOM_SITE_SPIP|textebrut)]]
    </title>
    [<meta name="description" content="(#INTRODUCTION|couper{150}|textebrut)" />]
    <INCLURE {fond=inclusions/inc-head}>
  </head>

  <body id="top" onload="setHover('menu')">
    <div id="ombre-gauche">
      <div id="ombre-droite">
        <div id="conteneur">

          <div id="entete">
            
            <INCLURE {fond=inclusions/inc-bandeau}>
            [(#CONFIG{escal/config/menuH}|non)<INCLURE {fond=inclusions/inc-menu}{env}>]
            [(#CONFIG{escal/config/menuH}|=={oui}|oui)<INCLURE {fond=inclusions/inc-menu}{env}>]
          </div>

          [(#REM) mise en place du lien vers le forum, du formulaire recherche et du menu de langues ]
          <div id="espace">
            <BOUCLE_forum(RUBRIQUES){titre_mot="forum"}>
            <a href="spip.php?page=rubrique-forum"><img id="boutonForum" src="[(#CHEMIN{images/forum_bouton.png})]" alt="lien vers le forum" /></a>
            </BOUCLE_forum>
            #FORMULAIRE_RECHERCHE
            <INCLURE {fond=inclusions/inc-menu_langues_self}>
          </div>

          <div id="page">
            <div id="contenu">
              <div id="cadre-rubrique">
                <div id="titre-rubrique"><:escal:page_contact:>
                </div>
              </div>
              <div id="formulaire-contact">
                <div id="descriptif-article">
                  <:escal:contact_bienvenue:>
                </div>


<!-- Merci a Alain Sichel pour cette page contact -->

<?php
function formulaire($Nom="",$Prenom="",$Email="",$Sujet="",$Niveau="",$Message="",$Antispam="") {
?>
                <form action="<?php echo $PHP_SELF ?>" method="post">
                  <ul id="item">
                    <li><div class="liste"><:escal:contact_nom:></div>
                    <input type="text" name="Nom" size="30" value="<?php echo trim(htmlentities($_POST['Nom'])) ?>" /></li>
                    <li><div class="liste"><:escal:contact_prenom:></div>
                    <input type="text" name="Prenom" value="<?php echo trim(htmlentities($_POST['Prenom'])) ?>" size="30" /></li>


                    
[(#CONFIG{escal/config/contactmail}|=={non}|oui) <!-- ]
                    <li><div class="liste"><:escal:contact_mail:></div>
                    <input type="text" name="Email" value="<?php echo trim(htmlentities($_POST['Email'])) ?>" size="30" /></li>
[(#CONFIG{escal/config/contactmail}|=={non}|oui) --> ]



[(#CONFIG{escal/config/radio}|=={non}|oui) <!-- ]
                    <li><:escal:contact_motif:></li>
                      <ul>
                        <li><input type="radio" name="Sujet" value="<:escal:contact_motif1:>"  size="30" <?php if ($_POST['Sujet']=='<:escal:contact_motif1:>') { echo 'checked="checked"'; } ?> /><:escal:contact_motif1:></li>
                        <li><input type="radio" name="Sujet" value="<:escal:contact_motif2:>"  size="30" <?php if ($_POST['Sujet']=='<:escal:contact_motif2:>') { echo 'checked="checked"'; } ?> /><:escal:contact_motif2:></li>
                        <li><input type="radio" name="Sujet" value="<:escal:contact_motif3:>"  size="30" <?php if ($_POST['Sujet']=='<:escal:contact_motif3:>') { echo 'checked="checked"'; } ?> /><:escal:contact_motif3:></li>
                        <li><input type="radio" name="Sujet" value="<:escal:contact_motif4:>"  size="30" <?php if ($_POST['Sujet']=='<:escal:contact_motif4:>') { echo 'checked="checked"'; } ?> /><:escal:contact_motif4:></li>
                        <li><input type="radio" name="Sujet" value="<:escal:contact_motif5:>"  size="30" <?php if ($_POST['Sujet']=='<:escal:contact_motif5:>') { echo 'checked="checked"'; } ?> /><:escal:contact_motif5:></li>
                      </ul>
[(#CONFIG{escal/config/radio}|=={non}|oui) --> ]




<div id="checkbox">
  <li>[(#CONFIG{escal/config/titrecheckbox}|oui)<br />[(#CONFIG{escal/config/titrecheckbox})]<br /><br /> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)<ul><li>]

        [(#CONFIG{escal/config/checkbox1}|non) <!-- ]
                      <input type="checkbox" name="Niveau[]" value="[(#CONFIG{escal/config/checkbox1}|_T_ou_typo)]"  <?php if ($_POST['Niveau']=='[(#CONFIG{escal/config/checkbox1})]') { echo 'checked="checked"'; } ?> />[(#CONFIG{escal/config/checkbox1}|_T_ou_typo)]
        [(#CONFIG{escal/config/checkbox1}|non) 1 --> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)</li><li>]

        [(#CONFIG{escal/config/checkbox2}|non) <!-- ]
                      <input type="checkbox" name="Niveau[]" value="[(#CONFIG{escal/config/checkbox2}|_T_ou_typo)]"  <?php if ($_POST['Niveau']=='[(#CONFIG{escal/config/checkbox2})]') { echo 'checked="checked"'; } ?> />[(#CONFIG{escal/config/checkbox2}|_T_ou_typo)]
        [(#CONFIG{escal/config/checkbox2}|non) 2 --> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)</li><li>]

        [(#CONFIG{escal/config/checkbox3}|non) <!-- ]
                      <input type="checkbox" name="Niveau[]" value="[(#CONFIG{escal/config/checkbox3}|_T_ou_typo)]"  <?php if ($_POST['Niveau']=='[(#CONFIG{escal/config/checkbox3})]') { echo 'checked="checked"'; } ?> />[(#CONFIG{escal/config/checkbox3}|_T_ou_typo)]
        [(#CONFIG{escal/config/checkbox3}|non) 3 --> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)</li><li>]

        [(#CONFIG{escal/config/checkbox4}|non) <!-- ]
                      <input type="checkbox" name="Niveau[]" value="[(#CONFIG{escal/config/checkbox4}|_T_ou_typo)]"  <?php if ($_POST['Niveau']=='[(#CONFIG{escal/config/checkbox4})]') { echo 'checked="checked"'; } ?> />[(#CONFIG{escal/config/checkbox4}|_T_ou_typo)]
        [(#CONFIG{escal/config/checkbox4}|non) 4 --> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)</li><li>]

        [(#CONFIG{escal/config/checkbox5}|non) <!-- ]
                      <input type="checkbox" name="Niveau[]" value="[(#CONFIG{escal/config/checkbox5}|_T_ou_typo)]"  <?php if ($_POST['Niveau']=='[(#CONFIG{escal/config/checkbox5})]') { echo 'checked="checked"'; } ?> />[(#CONFIG{escal/config/checkbox5}|_T_ou_typo)]
        [(#CONFIG{escal/config/checkbox5}|non) 5 --> ]

[(#CONFIG{escal/config/checkboxliste}|=={liste}|oui)</li></ul>]

  </li>
</div>


                  <li style="display:none;">
                    N'entrez rien dans ce champ *
                    <input type="text" name="Antispam" value="<?php echo trim(htmlentities($_POST['Antispam'])) ?>" size="30" />
                  </li>


                    <br /><br />
                    <li><:escal:contact_message:></li> <br />
                    <li>
                    <textarea name="Message" rows="10" cols="35" style="background-color:#ffffff"><?php if (ereg("[]%~#`$&|}{^[><]",$Message)) { echo "Certains caract&egrave;res utilis&eacute;s sont interdits";
                    $erreur=1; }
                    else {echo trim($_POST['Message']); } ?></textarea>  </li>  <li>
                    <input id="envoi" type="submit" name="Submit" value="<:escal:contact_envoyer:>" alt="Envoi"  title="Envoi de votre message" />  </li>
                  </ul>
<?php
//
// on recupere les donnees 
// on verifie si tout est bien rempli, sinon on envoie un message d'alerte
// si oui on prepare le contenu du mail
//
}
  include_spip('inc/filtres');

	$nom_site = entites_html($GLOBALS['meta']["nom_site"]);
	$email_webmaster = entites_html($GLOBALS['meta']["email_webmaster"]);
	
if(!isset($_POST["Nom"])) {
	formulaire();
}
else {
	$vNom=trim(utf8_decode($_POST["Nom"]));
	$vPrenom=trim(utf8_decode($_POST["Prenom"]));
	$vMessage=trim(utf8_decode($_POST["Message"]));
	$vEmail=trim(utf8_decode($_POST["Email"]));
	$vSujet=trim(utf8_decode($_POST["Sujet"]));
	$vAntispam=trim(htmlentities($_POST["Antispam"]));
  $destinataire="[(#CONFIG{escal/config/destinataire,#VAL{$email_webmaster}})]";
	$titre="<:escal:page_contact2|html2unicode|unicode2charset:> $nom_site";
	$message="<:escal:envoi_mail_provenance:> " . $_SERVER['HTTP_REFERER'] . "\n";
	$message.="<:escal:envoi_mail_ip:> " . $_SERVER['REMOTE_ADDR'] . "\n";
	$message.="<:escal:envoi_mail_navigateur:>" . $_SERVER['HTTP_USER_AGENT'] . "\n\n";
	$message.="<:escal:envoi_mail_nom:> $vNom\n";
	if (empty($vNom)) {
		echo "<p class='alerte'><:escal:contact_alerte_nom:></p>";
		$erreur=1;
	}	
	$message.="<:escal:envoi_mail_prenom:> $vPrenom\n\n";
	if (empty($vPrenom)) {
		echo "<p class='alerte'><:escal:contact_alerte_prenom:></p>";
		$erreur=1;
	}
	
if (lire_config('escal/config/contactmail', 'oui') == 'oui') {
	$message.="<:escal:envoi_mail_e_mail:> $vEmail\n\n";
	if (empty($vEmail)) {
		echo "<p class='alerte'><:escal:contact_alerte_mail1:></p>";
		$erreur=1;
	  }
	if (!eregi("^[0-9a-z]([-_.]?[0-9a-z])*@[0-9a-z]([-_.]?[0-9a-z])*\\.[a-z]{2,4}$",$vEmail) && ($erreur<>1)){
		echo "<p class='alerte'><:escal:contact_alerte_mail2:></p>";
		$erreur=1;
	  }
  }
  
if (lire_config('escal/config/radio', 'oui') == 'oui') {
	$message.="<:escal:envoi_mail_motif:> $vSujet\n\n";
	if (empty($vSujet)) {
		echo "<p class='alerte'><:escal:contact_alerte_motif:></p>";
		$erreur=1;
	}
  }
  $message.= "[(#CONFIG{escal/config/titrecheckbox})]";
  
if (is_array($_POST['Niveau'])) {
  $message.= implode(" - ",$_POST['Niveau']);
}

  $message.=" \n\n <:escal:envoi_mail_message:> \n $vMessage\n";
  if (empty($vMessage)) {
		echo "<p class='alerte'><:escal:contact_alerte_message:></p>";
		$erreur=1;
	}
		if (!empty($vAntispam)) {
		$erreur=1;
	}

	if ($erreur==1) {
		formulaire($Nom,$Prenom,$Email,$Sujet,$Niveau,$Message,$Antispam);
	}
	else {
//
// on prepare les headers et on envoie le mail
//
	       $headers ='From: <'.$vEmail.'>'."\n";
         $headers .='Content-Type: text/plain; charset="iso-8859-1"'."\n";
         $headers .='Content-Transfer-Encoding: 8bit';

   mail($destinataire,$titre,$message,$headers) ;

//
// on renvoie un message de confirmation
//

    if (empty($vEmail)) {
    echo '<p class="texte-retour1">
    <:escal:contact_retour_bonjour:> <span class="valeur1">  '. $vPrenom=utf8_encode(nl2br($vPrenom)) .' '. $vNom=utf8_encode(nl2br($vNom)) .'</span>.<br />
    <:escal:contact_retour_commentaire1:>
		</p>';
    }
    else{
		echo '<p class="texte-retour1">
		<:escal:contact_retour_bonjour:> <span class="valeur1">  '. $vPrenom=utf8_encode(nl2br($vPrenom)) .' '. $vNom=utf8_encode(nl2br($vNom)) .'</span>.<br />
    <:escal:contact_retour_commentaire1:>
    <:escal:contact_retour_commentaire2:>
		<span class="valeur1"> '. $vEmail .'</span>
    </p>';
    }

		 
    if (!empty($vSujet)) {
		echo '<p class="texte-retour2"><:escal:contact_motif:></p>';
		echo '<p class="valeur2">'. $vSujet=utf8_encode(nl2br($vSujet)) .'</p>';
		}
		
		if (!empty($_POST['Niveau'])) {
		echo '<p class="texte-retour2"><:escal:contact_retour_checkbox:></p>';
		for ($i=0; $i<count($_POST["Niveau"]); $i++)
		echo '<p class="valeur2">'. $_POST["Niveau"][$i].'</p>';
		}
		
		echo '<p class="texte-retour2"><:escal:contact_message:></p>';

		echo '<p class="valeur3">'. $vMessage=utf8_encode(nl2br($vMessage)) .'</p>';
	}
}
                  ?>
                </form>
              </div><!-- fin formulaire-contact -->
            </div><!-- fin contenu -->
          </div><!-- fin page -->

          <div id="navigation">
          <!-- affichage des 2 menus verticaux par defaut ou si selectionnes dans la page de configuration -->
            [(#CONFIG{escal/config/menuV1}|non)<div class="cadre-bleu"><INCLURE {fond=inclusions/inc-menu_vertical}{lang}></div>]
            [(#CONFIG{escal/config/menuV1}|=={oui}|oui)<div class="cadre-bleu"><INCLURE {fond=inclusions/inc-menu_vertical}{lang}></div>]

            [(#CONFIG{escal/config/menuV2}|non)<div class="cadre-bleu"><INCLURE {fond=inclusions/inc-menu_vertical_2}{lang}></div>]
            [(#CONFIG{escal/config/menuV2}|=={oui}|oui)<div class="cadre-bleu"><INCLURE {fond=inclusions/inc-menu_vertical_2}{lang}></div>]
            
            <div class="cadre-bleu">
              <INCLURE {fond=inclusions/inc-acces_direct}{lang}>
            </div>
          </div>

          <div id="pied">
            <INCLURE {fond=inclusions/inc-pied}{skel=#SQUELETTE}{lang}>
          </div>

        </div><!-- fin conteneur -->
      </div>
    </div>
  </body>
</html>