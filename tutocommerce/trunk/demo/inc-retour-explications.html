[(#REM)
	Tutoriel pour implémenter le framework ecommerce sous SPIP : Paiement / explications.
	Étape 4 : Fin > explication.
	Message de succès ou d'erreur.
]
<h1>Étape 4 : message de succès ou d'erreur</h1>

Selon le mode choisi pour le paiement, on peut être redirigé sur la page de son choix suite au succès ou à l'échec de celui-ci, par défaut <code>spip.php?page=bank_retour_ok</code> ou <code>spip.php?page=bank_retour_echec</code>.
Dans cette démo on affiche juste un message relatif au paiement : soit celui enregistré avec la transaction, soit un message générique. Il s'agit de chaînes de langues surchargeables du plugin «Banque & paiement».

Dans l'URL de retour sont insérés automatiquement quelques paramètres : l'identifiant, le hash et le type de la transaction, ce qui nous permet de faire une boucle :

<cadre class='spip'>\<BOUCLE_transaction(TRANSACTIONS){id_transaction}{transaction_hash}></cadre>

Parmi les balises disponibles, notons celles qui pourront nous servir ici : <code class='balise'>\#REGLEE</code> &rarr; <code>oui|non</code> permet de savoir si la transation a été payée, <code class='balise'>\#FINIE<</code> &rarr; <code>0|1</code> indique si la transaction est finie, <code class='balise'>\#MESSAGE</code> renvoie un message d'info relatif au règlement de la transaction, et <code class='balise'>\#STATUT</code> &rarr; <code>commande|ok|echec</code> donne le statut.

{{{Remarques complémentaires}}}

Le plugin [Zcommerce->http://contrib.spip.net/Z-Commerce] propose une démo du framework basée sur [Z-Spip version 1->http://contrib.spip.net/Le-Squelette-Zpip] et une suite complète de plugins. Les paiements sont gérés différemment, et il est compatible SPIP 2.

Pour découvrir toutes les options d'ecommerce avec SPIP, consultez l'article [Inventaire des outils SPIP pour du e-commerce->http://contrib.spip.net/Inventaire-des-outils-SPIP-pour-du-e-commerce].
